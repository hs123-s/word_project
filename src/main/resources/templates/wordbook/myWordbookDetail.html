<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>æˆ‘çš„è¯ä¹¦è¯¦ç»†ç•Œé¢</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="/bootstrap-3.3.7/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/myWordbookDetail.css">
<!--    <link rel="stylesheet" href="/css/toptab.css">-->

</head>
<body>

<div id="topTab" class="topTab container">
    <div class="row">
        <div class="back col-xs-2 col-md-1 col-md-offset-1 " style="cursor: pointer">
            <p><span class="glyphicon glyphicon-menu-left"></span></p>
        </div>
        <div class=" col-xs-8 col-md-8"><p>è¯ä¹¦è¯¦æƒ…</p></div>
        <div class="gotoBookDetail col-xs-2 " style="cursor: pointer">
            <span class="glyphicon glyphicon-option-vertical"></span></div>
    </div>
    <div class="container" style="padding: 0;">
        <div class="row wordTypes">
            <div class="col-xs-4">
                <div id="unMemorize" class="selected">
                    <p>æœªèƒŒ</p>
                </div>
            </div>
            <div class="col-xs-4">
                <div id="memorizing" ><p>å¤ä¹ ä¸­</p></div>
            </div>
           <div class="col-xs-4">
               <div id="memorized" ><p>æŒæ¡</p></div>
           </div>
<!--            æš‚ä¸å®ç°ï¼Œå¤ªå¤šæ´»äº†ï¼ŒğŸ‘´çƒ¦äº†-->
<!--           <div class="col-xs-3">-->
<!--               <div class="edit"><p>ç¼–è¾‘</p></div>-->
<!--           </div>-->
        </div>
    </div>
</div>



<div id="words" class="container">
    <audio id="sound" class="sound"  style="display:none;" src=""></audio>
    <div class="row unWordList"></div>
    <div class="row wordingList"></div>
    <div class="row wordedList"></div>


</div>
<!--    é˜…è¯»æŒ‰é’®-->
<div class="container" style="display: flex;justify-content: center;">
    <div class="showWordsBtn" style="width: 70%"><p style="text-align:center;">æ›´ å¤š</p></div>
</div>
</body>


</html>
<script src="/jq/jquery.min.js"></script>
<script src="/js/dropload.min.js"></script>

<!--ä¸‹æ‹‰åˆ·æ–°ï¼ˆ*ï¼‰-->
<script>


    //è·å–é¡µé¢å‚æ•°
    function getQueryVariable(variable)
    {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++) {
            var pair = vars[i].split("=");
            if(pair[0] == variable){return pair[1];}
        }
        return(false);
    }


</script>


<!--å‘éŸ³-->
<script>

    $(".back").click(function () {
        window.history.back(-1);
    });

    reloadUtil();

    //å› ä¸ºå¾€é¡µé¢æ–°æ·»ä¸œè¥¿æ˜¯æ²¡æœ‰ç»‘å®šäº‹ä»¶çš„ï¼Œæ‰€ä»¥è¦é‡æ–°ç»‘å®šï¼Œè¿™æ ·è¿˜ä¸å¦‚ç”¨freemarkerå‘¢ï¼Œå“ã€‚
    function reloadUtil(){
        //ç‚¹å‡»å‘éŸ³(åˆ°æ—¶è¦ç”¨on)
        $(".pron").on("click",this,function () {
            let word = $(this).attr("title");
            let src = "http://media.shanbay.com/audio/us/"+word+".mp3";
            $("#sound").attr("src",src);
            $("#sound")[0].play();
        });

        //æ–©è¯æŒ‰é’®
        $(".cutBox").on("click",this,function () {
            $(this).parent().fadeOut(200);
            //å¼„ä¸ªç‰¹æ•ˆï¼Œå…¶å®é‡Œé¢ä¹Ÿå¯ä»¥ajax
            setTimeout(function () {
                //     $(this).parent().parent().removeChild($(this).parent())
                this.parentNode.parentNode.removeChild(this.parentNode);
            },200)

        });

        //é‡æ–°å­¦ä¹ æŒ‰é’®
        $(".reLearnBox").on("click",this,function () {
            $(this).parent().fadeOut(200);
            //å¼„ä¸ªç‰¹æ•ˆï¼Œå…¶å®é‡Œé¢ä¹Ÿå¯ä»¥ajax
            setTimeout(function () {
                //     $(this).parent().parent().removeChild($(this).parent())
                this.parentNode.parentNode.removeChild(this.parentNode);
            },200)

        });

    }

    // ç±»å‹é€‰ä¸­åæ•ˆæœ
    $("#memorizing,#memorized,#unMemorize").click(function () {

        $("#memorizing,#memorized,#unMemorize").removeClass("selected");
        $(this).addClass("selected");
        $(".cutBox,.reLearnBox").hide(100)
    });

    //ç¼–è¾‘
    $(".edit").click(function () {
       $(".cutBox,.reLearnBox").toggle(300);
        event.stopPropagation();
    })


</script>
<SCRIPT>

    //æœªèƒŒcurr
    let currUn = 1;
    let unFlag = true;
    //è®°å¿†ä¸­curr
    let currIng = 1;
    let ingFlag = true;
    //æŒæ¡curr
    let currEd = 1;
    let edFlag = true;
    //è·å–è¯ä¹¦id
    let wordbookId = getQueryVariable("id");
    // wordsType è¿”å›å•è¯ç±»å‹ï¼Œ1ä¸ºæœªèƒŒï¼Œ2ä¸ºè®°å¿†ä¸­ï¼Œ3ä¸ºå·²æŒæ¡
    let wordsType = 1;
    $(function () {

        /**
         * å…ˆé»˜è®¤åŠ è½½æœªèƒŒå•è¯
         * @type {*|boolean}
         */

            // åˆ†é¡µ
        var data = {curr:currUn,size:30};
        data = JSON.stringify(data);
        $.ajax({
            type: "post",
            async: true,     //å¼‚æ­¥æ‰§è¡Œ
            data: data,
            contentType: "application/json;charset=UTF-8",
            url: "/wordbook/myWordbook/words/" +wordbookId+ "/1",
            dataType: "json", //jsonç±»å‹
            success: function(result) {
                currUn++;
                unFlag = false;
                // console.log(result)
                if(result.code == 200){
                    $.each(result.words,function (i,item) {
                        $('.unWordList').append("<div class=\"wordBox\">\n" +
                            "            <div class=\"col-xs-10 wordArea\">\n" +
                            "                <p class=\"word\" title=\""+ item.word +"\">"+ item.word +"</p>\n" +
                            "                <!--            å°†æ¢è¡Œå»é™¤-->\n" +
                            "                <p class=\"wordMean\">"+ item.paraphrase +"</p>\n" +
                            "            </div>\n" +
                            "\n" +
                            "            <div class=\"col-xs-1 pronBox\" style=\"padding: 0 5px;\"><span title=\""+ item.word +"\" class=\"glyphicon glyphicon-volume-down pron\" > </span></div>\n" +
                            "            <div class=\"col-xs-1 cutBox\" style=\"padding: 0 5px;\"><span title=\""+ item.id +"\" class=\"cutWord\" >æ–©</span></div>\n" +
                            "            <div class=\"col-xs-12 word-line\"></div>\n" +
                            "        </div>")
                    })
                }

                reloadUtil();

            },
            error: function(errmsg) {
                console.log("Ajaxè·å–æœåŠ¡å™¨æ•°æ®å‡ºé”™äº†ï¼"+ errmsg);
            }

        })
    });

    //æœªèƒŒ
    $("#unMemorize").click(function () {
        if(unFlag){
            getWords(1,currUn);
            currUn++;
        }else{
            $("#words>div").hide();
            $(".unWordList").show();
        }
        wordsType = 1;
        $(".showWordsBtn p").html("æ›´ å¤š");
    });

    //æ­£åœ¨èƒŒ
    $("#memorizing").click(function () {
        if(ingFlag){
            getWords(2,currIng);
            currIng++;
            ingFlag = false;
        }else{
            $("#words>div").hide();
            $(".wordingList").show();
        }
        wordsType = 2;

    });

    //å·²èƒŒ
    $("#memorized").click(function () {
        if(edFlag){
            getWords(3,currEd);
            currEd++;
            edFlag = false;
        }else{
            $("#words>div").hide();
            $(".wordedList").show();
        }
        wordsType = 3;

    });


    //è·å–å•è¯
    function getWords(type,curr) {
        let data = {curr:curr,size:30};
        data = JSON.stringify(data);
        $.ajax({
            type: "post",
            async: true,     //å¼‚æ­¥æ‰§è¡Œ
            data: data,
            contentType: "application/json;charset=UTF-8",
            url: "/wordbook/myWordbook/words/" +wordbookId+ "/"+type,
            dataType: "json", //jsonç±»å‹
            success: function(result) {
                // console.log(result);
                let data;
                if(result.code == 200){
                    data = result.words;
                }
                if(type == 1){
                    $("#words>div").hide();
                    $(".unWordList").show();
                    if(result.code == 504){
                        $(".showWordsBtn p").html("å·²åˆ°åº•éƒ¨");
                        return ;
                    }
                    $.each(data,function (i,item) {
                        $('.unWordList').append("<div class=\"wordBox\">\n" +
                            "            <div class=\"col-xs-10 wordArea\">\n" +
                            "                <p class=\"word\" title=\""+ item.word +"\">"+ item.word +"</p>\n" +
                            "                <!--            å°†æ¢è¡Œå»é™¤-->\n" +
                            "                <p class=\"wordMean\">"+ item.paraphrase +"</p>\n" +
                            "            </div>\n" +
                            "\n" +
                            "            <div class=\"col-xs-1 pronBox\" style=\"padding: 0 5px;\"><span title=\""+ item.word +"\" class=\"glyphicon glyphicon-volume-down pron\" > </span></div>\n" +
                            "            <div class=\"col-xs-1 cutBox\" style=\"padding: 0 5px;\"><span title=\""+ item.id +"\" class=\"cutWord\" >æ–©</span></div>\n" +
                            "            <div class=\"col-xs-12 word-line\"></div>\n" +
                            "        </div>")
                        })

                    $(".showWordsBtn p").html("æ›´ å¤š");

                }else if(type == 2){
                    $("#words>div").hide();
                    $(".wordingList").show();
                    if(result.code == 504){
                        $(".showWordsBtn p").html("å·²åˆ°åº•éƒ¨");
                        return ;
                    }
                    $.each(data,function (i,item) {
                        $('.wordingList').append("<div class=\"wordBox\">\n" +
                            "            <div class=\"col-xs-10 wordArea\">\n" +
                            "                <p class=\"word\" title=\""+ item.word +"\">"+ item.word +"</p>\n" +
                            "                <!--            å°†æ¢è¡Œå»é™¤-->\n" +
                            "                <p class=\"wordMean\">"+ item.paraphrase +"</p>\n" +
                            "            </div>\n" +
                            "\n" +
                            "            <div class=\"col-xs-1 pronBox\" style=\"padding: 0 5px;\"><span title=\""+ item.word +"\" class=\"glyphicon glyphicon-volume-down pron\" > </span></div>\n" +
                            "            <div class=\"col-xs-1 cutBox\" style=\"padding: 0 5px;\"><span title=\""+ item.id +"\" class=\"cutWord\" >æ–©</span></div>\n" +
                            "            <div class=\"col-xs-12 word-line\"></div>\n" +
                            "        </div>")
                    });

                    $(".showWordsBtn p").html("æ›´ å¤š");
                }else if(type == 3){
                    $("#words>div").hide();
                    $(".wordedList").show();
                    if(result.code == 504){
                        $(".showWordsBtn p").html("å·²åˆ°åº•éƒ¨");
                        return ;
                    }
                    $.each(data,function (i,item) {
                        $('.wordedList').append("<div class=\"wordBox\">\n" +
                            "            <div class=\"col-xs-10 wordArea\">\n" +
                            "                <p class=\"word\" title=\""+item.word+"\">"+item.word +"</p>\n" +
                            "                <p class=\"wordMean\">"+item.paraphrase+"</p>\n" +
                            "            </div>\n" +
                            "            <div class=\"col-xs-1 pronBox\" style=\"padding: 0 5px;\"><span title=\""+item.word+"\" class=\"glyphicon glyphicon-volume-down pron\" > </span></div>\n" +
                            "            <div class=\"col-xs-1 reLearnBox\" style=\"padding: 0 5px;\"><span title=\""+item.id+"\" class=\"reLearn glyphicon glyphicon-circle-arrow-left\" ></span></div>\n" +
                            "\n" +
                            "            <div class=\"col-xs-12 word-line\"></div>\n" +
                            "        </div>")
                    })
                    $(".showWordsBtn p").html("æ›´ å¤š");
                }
                reloadUtil();

            },
            error: function(errmsg) {
                console.log("Ajaxè·å–æœåŠ¡å™¨æ•°æ®å‡ºé”™äº†ï¼"+ errmsg);
            }
        })
    }

    $(".showWordsBtn").click(function () {
        switch (wordsType) {
            case 1: getWords(1,currUn);currUn++;break;
            case 2: getWords(2,currIng);currIng++;break;
            case 3: getWords(3,currEd);currEd++;break;
        }
    });
</SCRIPT>